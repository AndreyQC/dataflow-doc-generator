# DataFlow Documentation Generator

Генератор документации для анализа потоков данных в SQL-скриптах. Проект позволяет автоматически создавать визуализацию связей между таблицами, представлениями и хранимыми процедурами в базе данных.

## Структура проекта

```
src/
├── common/                    # Общие модули
│   ├── __init__.py
│   ├── config.py             # Работа с конфигурацией
│   ├── dflw_modules.py       # Вспомогательные функции
│   ├── dflw_getfiles.py      # Функции для работы с файлами
│   └── logger.py             # Настройка логирования
├── sql_processor.py          # Обработка SQL-файлов
└── dataflow_doc_generator.py # Генерация визуализации
```

## Требования

- Python 3.10+
- UV (современный менеджер пакетов Python)
- Зависимости указаны в `requirements.txt`

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd dataflow-doc-generator
```

2. Установите UV (если еще не установлен):
```bash
pip install uv
```

3. Создайте виртуальное окружение и установите зависимости:
```bash
uv venv
.venv\Scripts\activate  # для Windows
source .venv/bin/activate  # для Linux/Mac
uv pip install -r pyproject.toml
```

## Конфигурация

Настройки проекта хранятся в файле `config.yml`:

```yaml
database:
  container_name: "postgres"    # Имя контейнера базы данных
  container_type: "database"    # Тип контейнера

paths:
  sql_files: "path/to/sql/files"    # Путь к SQL-файлам
  output_json: "path/to/output.json" # Путь для сохранения JSON
  output_folder: "path/to/output"    # Папка для выходных файлов

visualization:
  height: "750px"              # Высота визуализации
  width: "100%"                # Ширина визуализации
  colors:
    table: "lightblue"         # Цвет для таблиц
    default: "lightgreen"      # Цвет по умолчанию
```

## Использование

1. Настройте пути в `config.yml`
2. Запустите обработку SQL-файлов:
```bash
python src/sql_processor.py
```
3. Сгенерируйте визуализацию:
```bash
python src/dataflow_doc_generator.py
```

Результатом работы будет HTML-файл `database.html` с интерактивной визуализацией связей между объектами базы данных.

## Логирование

Проект использует loguru для логирования. Логи сохраняются в директории `logs/`:
- `app.log` - основной лог с уровнем DEBUG
- `error.log` - лог ошибок

## Функциональность

- Анализ SQL-скриптов для поиска объектов базы данных
- Определение связей между таблицами, представлениями и хранимыми процедурами
- Генерация JSON-файлов с метаданными объектов
- Создание интерактивной визуализации с использованием pyvis
- Поддержка различных типов SQL-объектов (таблицы, представления, процедуры)
- Подробное логирование всех операций

## Поддерживаемые типы объектов

- Таблицы (CREATE TABLE)
- Представления (CREATE VIEW)
- Хранимые процедуры (CREATE PROCEDURE)
- Функции (CREATE FUNCTION)
- Схемы (CREATE SCHEMA)

## Визуализация

Визуализация включает:
- Различные цвета для разных типов объектов
- Интерактивное управление (масштабирование, перемещение)
- Фильтрация по типам объектов
- Отображение связей между объектами